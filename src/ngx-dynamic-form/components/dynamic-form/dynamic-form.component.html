<ng-template #labelTemplate let-control="control" let-form="control.form" let-data="control.data">
    <label [ngClass]="'control-label control-label-' + data.labelAlign" [attr.for]="form.id + '-' + control.id">
        {{ control.label | translate }}
    </label>
</ng-template>
<ng-template #errorTemplate let-control="control">
    <div class="error-message" *ngIf="control.errors && control.touched">
        <span class="help-block" *ngFor="let error of control.errors | entries">
            {{ error.key | translate: error.value }}
        </span>
    </div>
</ng-template>
<ng-template #inputTemplate let-control="control">
    <ng-container [form-control]="control"></ng-container>
</ng-template>
<ng-template #defaultControlTemplate
             let-context
             let-control="control"
             let-data="control.data"
             let-labelTemplate="labelTemplate"
             let-inputTemplate="inputTemplate"
             let-prefixTemplate="prefixTemplate"
             let-suffixTemplate="suffixTemplate"
             let-errorTemplate="errorTemplate">
    <ng-container [ngTemplateOutlet]="prefixTemplate"
                  [ngTemplateOutletContext]="context"></ng-container>
    <ng-container *ngIf="control.label && data.labelAlign == 'left'"
                  [ngTemplateOutlet]="labelTemplate"
                  [ngTemplateOutletContext]="context">
    </ng-container>
    <ng-container [ngTemplateOutlet]="inputTemplate"
                  [ngTemplateOutletContext]="context"></ng-container>
    <ng-container *ngIf="control.label && data.labelAlign == 'right'"
                  [ngTemplateOutlet]="labelTemplate"
                  [ngTemplateOutletContext]="context">
    </ng-container>
    <ng-container [ngTemplateOutlet]="suffixTemplate"
                  [ngTemplateOutletContext]="context"></ng-container>
    <ng-container [ngTemplateOutlet]="errorTemplate"
                  [ngTemplateOutletContext]="context"></ng-container>
</ng-template>

<ng-template #defaultFieldSetTemplate let-id="id" let-controls="controls" let-fieldSet="fieldSet">
    <div [ngClass]="['form-fields', 'form-fields-' + id, fieldSet.classes]">
        <div class="form-title" *ngIf="fieldSet.title">{{ group.prefix + fieldSet.title | translate }}</div>
        <div *ngFor="let control of controls" [ngClass]="['form-group', 'form-group-' + control.id, control.data.classes]">
            <ng-container *ngIf="control.visible"
                          [ngTemplateOutlet]="controlTemplates[control.id] || controlTemplate || defaultControlTemplate"
                          [ngTemplateOutletContext]="{
                            $implicit: {control: control},
                            control: control,
                            labelTemplate: labelTemplates[control.id] || labelTemplate,
                            inputTemplate: inputTemplates[control.id] || inputTemplate,
                            prefixTemplate: prefixTemplates[control.id],
                            suffixTemplate: suffixTemplates[control.id],
                            errorTemplate: errorTemplate
                          }">
            </ng-container>
        </div>
    </div>
</ng-template>

<ng-template #fieldSetsTemplate>
    <ng-container *ngFor="let fs of formControls | groupBy:'data.fieldSet'"
                  [ngTemplateOutlet]="fieldSetTemplate || defaultFieldSetTemplate"
                  [ngTemplateOutletContext]="{form: this, id: fs.group, controls: fs.items, fieldSet: group.formFields[fs.group] || defaultFieldSet}">
    </ng-container>
</ng-template>
<ng-template #defaultWrapperTemplate let-form="form" let-fieldSetsTemplate="fieldSetsTemplate">
    <ng-container [ngTemplateOutlet]="prefixTemplate"
                  [ngTemplateOutletContext]="{form: form, fieldSetsTemplate: fieldSetsTemplate}"></ng-container>
    <form class="dynamic-form" [ngClass]="form.classes || ''" [formGroup]="group" (submit)="onFormSubmit()">
        <div *ngIf="form.status == 'LOADING'" class="dynamic-form-loader">{{ group.prefix + 'message.loading' |
            translate }}</div>
        <ng-container [ngTemplateOutlet]="fieldSetsTemplate"></ng-container>
        <ng-content></ng-content>
        <div *ngIf="form.status == 'PENDING'" class="dynamic-form-validator">{{ group.prefix + 'message.pending' |
            translate }}</div>
        <button [ngStyle]="{display: 'none'}">Submit</button>
    </form>
    <ng-container [ngTemplateOutlet]="suffixTemplate"
                  [ngTemplateOutletContext]="{form: form, fieldSetsTemplate: fieldSetsTemplate}"></ng-container>
</ng-template>
<ng-container [ngTemplateOutlet]="wrapperTemplate || defaultWrapperTemplate" [ngTemplateOutletContext]="{form: this, fieldSetsTemplate: fieldSetsTemplate}"></ng-container>
