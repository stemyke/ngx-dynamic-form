<ng-template #fieldSetTemplate let-id="id" let-controls="controls" let-fieldSet="fieldSet">
    <div [ngClass]="['form-fields', 'form-fields-' + id, fieldSet.classes]">
        <div class="form-title" *ngIf="fieldSet.title">{{ prefix + fieldSet.title | translate }}</div>
        <div *ngFor="let control of controls"
             [ngClass]="['form-group', 'form-group-' + control.id, control.data.classes]"
             [dynamic-form-control]="control"
             [form]="this">
        </div>
    </div>
</ng-template>
<form class="dynamic-form" (submit)="onFormSubmit()">
    <div *ngIf="isLoading" class="dynamic-form-loader">{{ prefix + 'message.loading' | translate }}</div>
    <ng-container *ngFor="let fs of formControls | groupBy:'data.fieldSet'"
                  [ngTemplateOutlet]="fieldSetTemplate"
                  [ngTemplateOutletContext]="{id: fs.group, controls: fs.items, fieldSet: formFieldSets[fs.group] || defaultFieldSet}">
    </ng-container>
    <ng-content></ng-content>
    <div *ngIf="isValidating" class="dynamic-form-validator">{{ prefix + 'message.validating' | translate }}</div>
    <button [ngStyle]="{display: 'none'}">Submit</button>
</form>
